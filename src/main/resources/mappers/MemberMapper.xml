<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.repository.MemberDAO">

	<select id="loginCheck" parameterType="MemberVO"
		resultType="loginVO">
		SELECT *
		FROM MEMBER M
		INNER JOIN EMP E ON M.EMP_NO =
		E.EMP_NO
		INNER JOIN DEPT D ON E.DEPT_NO = D.DEPT_NO
		WHERE M.EMP_NO =
		#{empNo}
		AND M.EMP_PASS = #{empPass}
	</select>

	<select id="memberCheck" parameterType="Long" resultType="int">
		SELECT
		*
		FROM KAKAO_API_LINK
		WHERE KAKAO_ID = #{kakaoId}
	</select>

	<select id="getNextMemberNo" resultType="java.lang.Long">
		SELECT
		MEMBER_SEQ.NEXTVAL FROM DUAL
	</select>


	<insert id="insertMember" parameterType="MemberSaveVO">
		INSERT INTO MEMBER (MEMBER_NO, EMP_NO, EMP_PASS)
        SELECT 
            #{memberNo}, 
            #{empNo}, 
            #{empPass}
        FROM DUAL
        WHERE EXISTS (
            SELECT 1 
            FROM EMP 
            WHERE EMP_NO = #{empNo}
        )
	</insert>

	<insert id="insertKakaoApiLink">
		INSERT INTO KAKAO_API_LINK (KAKAO_ID, MEMBER_NO)
        VALUES (
            #{kakaoId}, 
            #{memberNo}
        )
	</insert>
</mapper>