<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.repository.SalMapper">

    <select id="selectSalList" parameterType="int" resultType="com.example.domain.SalVO">

        SELECT
            s.SAL_NUM         										AS salNum,
            s.EMP_NO          										AS empNo,
            s.MONTH_ATTNO     									AS monthAttno,
            TO_CHAR(s.SAL_DATE,'YYYY-MM-DD') 	AS salDate,
            s.SAL_BASE        										AS salBase,
            NVL(s.SAL_BONUS,0) 								AS salBonus,
            NVL(s.SAL_PLUS,0)  									AS salPlus,
            s.INSURANCE       										AS insurance,
            s.TAX             												AS tax,
            (s.SAL_BASE + NVL(s.SAL_BONUS,0) + NVL(s.SAL_PLUS,0) 
             - s.INSURANCE - s.TAX) 							
             																	AS realPay
        FROM SAL s
        WHERE s.EMP_NO = #{empNo}
        ORDER BY s.SAL_DATE DESC

    </select>
    
    <!-- 급여 존재 여부 확인 -->
    <select id="existsSal" resultType="int">
    SELECT COUNT(*) 
    FROM SAL
    WHERE MONTH_ATTNO = #{monthAttno}
</select>

	<!-- 급여 입력 -->
	<insert id="insertSal" parameterType="com.example.domain.SalVO">
    INSERT INTO SAL (
        SAL_NUM,
        MONTH_ATTNO,
        EMP_NO,
        SAL_DATE,
        SAL_BASE,
        SAL_BONUS,
        SAL_PLUS,
        INSURANCE,
        TAX
    )
    VALUES (
        SAL_SEQ.NEXTVAL,
        #{monthAttno},
        #{empNo},
        SYSDATE,
        #{salBase},
        #{salBonus},
        #{salPlus},
        #{insurance},
        #{tax}
    )
</insert>

<select id="getSalList" parameterType="int"
        resultType="com.example.domain.SalVO">
    SELECT
        SAL_NUM     AS salNum,
        MONTH_ATTNO AS monthAttno,
        EMP_NO      AS empNo,
        SAL_DATE    AS salDate,
        SAL_BASE    AS salBase,
        SAL_BONUS   AS salBonus,
        SAL_PLUS    AS salPlus,
        INSURANCE   AS insurance,
        TAX         AS tax
    FROM SAL
    WHERE EMP_NO = #{empNo}
    ORDER BY SAL_DATE DESC
</select>

<select id="getSalDetail" parameterType="int"
        resultType="com.example.domain.SalVO">
    SELECT
        SAL_NUM     AS salNum,
        MONTH_ATTNO AS monthAttno,
        EMP_NO      AS empNo,
        SAL_DATE    AS salDate,
        SAL_BASE    AS salBase,
        SAL_BONUS   AS salBonus,
        SAL_PLUS    AS salPlus,
        INSURANCE   AS insurance,
        TAX         AS tax
    FROM SAL
    WHERE SAL_NUM = #{salNum}
</select>

<select id="existsMonthlySalary" resultType="int">
    SELECT COUNT(*)
    FROM SAL
    WHERE EMP_NO = #{empNo}
      AND MONTH_ATTNO = #{monthAttno}
</select>
</mapper>