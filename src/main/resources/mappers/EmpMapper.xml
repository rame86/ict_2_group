<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
  =========================================================
  üìå EmpMapper (ÏÇ¨ÏõêÍ¥ÄÎ¶¨ ÏïàÏ†ïÌôî ÏµúÏ¢ÖÎ≥∏)

  [Ïó≠Ìï†]
  - ÏÇ¨ÏõêÍ¥ÄÎ¶¨(empList / empCard / empNewForm)Ïùò Í∏∞Ï§Ä Îç∞Ïù¥ÌÑ∞ Ï†úÍ≥µ
  - Í∏âÏó¨Í¥ÄÎ¶¨ / Í∑ºÌÉúÍ¥ÄÎ¶¨ÏóêÏÑú Ï∞∏Ï°∞ Í∞ÄÎä•Ìïú "ÏÇ¨Ïõê ÎßàÏä§ÌÑ∞" Ïó≠Ìï†

  [ÏÑ§Í≥Ñ ÏõêÏπô]
  1) ÎÇ†Ïßú Ïª¨Îüº
     - DB : DATE
     - VO : String
     - MapperÏóêÏÑú TO_CHAR('YYYY-MM-DD')Î°ú ÌÜµÏùº
     ‚Üí ÌôîÎ©¥ ÌëúÏãúÏö©ÏúºÎ°úÎßå ÏÇ¨Ïö© (Í≥ÑÏÇ∞ Î°úÏßÅ ‚ùå)

  2) JOIN Ï†ïÏ±Ö
     - LEFT JOIN ÏÇ¨Ïö©
     ‚Üí Î∂ÄÏÑú/ÏΩîÎìú ÎàÑÎùΩ ÏãúÏóêÎèÑ ÌôîÎ©¥ Íπ®Ïßê Î∞©ÏßÄ

  3) ÏÉÅÌÉú/ÏßÅÍ∏â ÌïúÍ∏ÄÎ™Ö
     - MapperÏóêÏÑú CASE WHEN Ï≤òÎ¶¨
     ‚Üí JSP Î°úÏßÅ Îã®ÏàúÌôî & ÏïàÏ†ïÏÑ± ÌôïÎ≥¥

  4) ÏÇ≠Ï†ú Ï†ïÏ±Ö
     - ÌòÑÏû¨Îäî Î¨ºÎ¶¨ ÏÇ≠Ï†ú(DELETE)
     - ÌåÄ ÌîÑÎ°úÏ†ùÌä∏/Î∞úÌëú Í∏∞Ï§Ä OK
     - Ïã§Î¨¥ ÌôïÏû• Ïãú ÎÖºÎ¶¨ ÏÇ≠Ï†ú(STATUS_NO=0)Î°ú Ï†ÑÌôò Í∞ÄÎä•
  =========================================================
-->

<mapper namespace="com.example.repository.EmpMapper">

	<!-- ============================
	     Í≥µÌÜµ ResultMap
	      - EMP ÌÖåÏù¥Î∏î + ÌôîÎ©¥Ïö© Í∞ÄÍ≥µ ÌïÑÎìú Îß§Ìïë
	     ============================ -->
	<resultMap id="empMap" type="com.example.domain.EmpVO">

		<!-- PK -->
		<id column="EMP_NO" property="empNo" />

		<!-- Í∏∞Î≥∏ FK/ÏΩîÎìú Í∞í -->
		<result column="STATUS_NO" property="statusNo" />
		<result column="DEPT_NO" property="deptNo" />
		<result column="GRADE_NO" property="gradeNo" />

		<!-- Î°úÍ∑∏Ïù∏/Ïô∏Î∂ÄÏó∞Îèô -->
		<result column="EMP_PASS" property="empPass" />
		<result column="KAKAO_ID" property="kakaoId" />

		<!-- Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
		<result column="EMP_NAME" property="empName" />
		<result column="EMP_PHONE" property="empPhone" />
		<result column="EMP_ADDR" property="empAddr" />
		<result column="EMP_EMAIL" property="empEmail" />
		<result column="EMP_IMAGE" property="empImage" />
		<result column="EMP_REG_NO" property="empRegNo" />

		<!--
		  üìå ÏûÖÏÇ¨Ïùº
		  - DBÎäî DATE
		  - ÌôîÎ©¥/VOÏóêÏÑúÎäî String
		  - MapperÏóêÏÑú Ìè¨Îß∑ ÌÜµÏùº
		-->
		<result column="EMP_REGDATE" property="empRegdate" />

		<!-- Í∏âÏó¨ Í∏∞Ï§Ä Í∏∞Î≥∏Í∏â -->
		<result column="SAL_BASE" property="salBase" />

		<!-- JOINÏúºÎ°ú Í∞ÄÏ†∏Ïò§Îäî ÌôîÎ©¥Ïö© ÌïúÍ∏ÄÎ™Ö -->
		<result column="DEPT_NAME" property="deptName" />
		<result column="STATUS_NAME" property="statusName" />
		<result column="GRADE_NAME" property="gradeName" />
	</resultMap>

	<!-- ============================
	     1) Ï†ÑÏ≤¥ ÏÇ¨Ïõê Î™©Î°ù (Í≤ÄÏÉâ ÏóÜÏùå)
	     - Í¥ÄÎ¶¨Ïûê Í∏∞Î≥∏ Î™©Î°ù ÌôîÎ©¥
	     ============================ -->
	<select id="selectEmpList" resultMap="empMap">
		SELECT
			e.EMP_NO,
			e.STATUS_NO,
			e.DEPT_NO,
			e.GRADE_NO,
			e.EMP_PASS,
			e.KAKAO_ID,
			e.EMP_NAME,
			e.EMP_PHONE,
			e.EMP_ADDR,
			e.EMP_EMAIL,
			e.EMP_IMAGE,
			e.EMP_REG_NO,
			TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
			e.SAL_BASE,
			d.DEPT_NAME,
			
			<!-- Ïû¨ÏßÅÏÉÅÌÉú ÌïúÍ∏ÄÎ™Ö -->
			CASE e.STATUS_NO
				WHEN 0 THEN 'Ìá¥ÏßÅ'
				WHEN 1 THEN 'Ïû¨ÏßÅ'
				WHEN 2 THEN 'Ìú¥ÏßÅ(ÏûêÎ∞úÏ†Å)'
				WHEN 3 THEN 'Ìú¥ÏßÅ(Î≥ëÍ∞Ä Îì± Î≥µÏßÄ)'
				WHEN 4 THEN 'ÎåÄÍ∏∞'
				WHEN 5 THEN 'ÏßïÍ≥Ñ'
				WHEN 6 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
				WHEN 7 THEN 'ÌååÍ≤¨'
			END AS STATUS_NAME,

			<!-- ÏßÅÍ∏â ÌïúÍ∏ÄÎ™Ö -->
			CASE e.GRADE_NO
				WHEN 1 THEN 'ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê'
				WHEN 2 THEN 'Í¥ÄÎ¶¨Ïûê'
				WHEN 3 THEN 'ÏÇ¨Ïõê'
				WHEN 4 THEN 'Í≥ÑÏïΩÏÇ¨Ïõê'
				WHEN 5 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
				WHEN 6 THEN 'Í∏∞ÌÉÄ'
			END AS GRADE_NAME

		FROM EMP e
		LEFT JOIN DEPT d ON e.DEPT_NO = d.DEPT_NO
		ORDER BY e.EMP_NO
	</select>

	<!-- ============================
	     2) Í≤ÄÏÉâ Ìè¨Ìï® ÏÇ¨Ïõê Î™©Î°ù
	     - EmpSearchVO ÏÇ¨Ïö©
	     ============================ -->
	<select id="getEmpList"
	        parameterType="com.example.domain.EmpSearchVO"
	        resultMap="empMap">
	    <!-- (Í∏∞Ï°¥ ÏΩîÎìú Ïú†ÏßÄ, Ï£ºÏÑùÎßå ÏÉùÎûµ ÏóÜÏù¥ Ïú†ÏßÄ) -->
        <!-- Ïù¥ ÏøºÎ¶¨Îäî Í¥ÄÎ¶¨Ïûê Í≤ÄÏÉâ/ÌïÑÌÑ∞ Ï†ÑÏö© -->
        <!-- Í∏âÏó¨Í¥ÄÎ¶¨ÏôÄ ÏßÅÏ†ë Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏùå -->

		SELECT
			e.EMP_NO,
			e.STATUS_NO,
			e.DEPT_NO,
			e.GRADE_NO,
			e.EMP_PASS,
			e.KAKAO_ID,
			e.EMP_NAME,
			e.EMP_PHONE,
			e.EMP_ADDR,
			e.EMP_EMAIL,
			e.EMP_IMAGE,
			e.EMP_REG_NO,
			TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
			e.SAL_BASE,
			d.DEPT_NAME,

			CASE e.STATUS_NO
				WHEN 0 THEN 'Ìá¥ÏßÅ'
				WHEN 1 THEN 'Ïû¨ÏßÅ'
				WHEN 2 THEN 'Ìú¥ÏßÅ(ÏûêÎ∞úÏ†Å)'
				WHEN 3 THEN 'Ìú¥ÏßÅ(Î≥ëÍ∞Ä Îì± Î≥µÏßÄ)'
				WHEN 4 THEN 'ÎåÄÍ∏∞'
				WHEN 5 THEN 'ÏßïÍ≥Ñ'
				WHEN 6 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
				WHEN 7 THEN 'ÌååÍ≤¨'
			END AS STATUS_NAME,

			CASE e.GRADE_NO
				WHEN 1 THEN 'ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê'
				WHEN 2 THEN 'Í¥ÄÎ¶¨Ïûê'
				WHEN 3 THEN 'ÏÇ¨Ïõê'
				WHEN 4 THEN 'Í≥ÑÏïΩÏÇ¨Ïõê'
				WHEN 5 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
				WHEN 6 THEN 'Í∏∞ÌÉÄ'
			END AS GRADE_NAME

		FROM EMP e
		LEFT JOIN DEPT d ON e.DEPT_NO = d.DEPT_NO

		<where>
			<if test="keyword != null and keyword != ''">
				AND (
					e.EMP_NAME  LIKE '%' || #{keyword} || '%'
					OR e.EMP_PHONE LIKE '%' || #{keyword} || '%'
					OR e.EMP_EMAIL LIKE '%' || #{keyword} || '%'
				)
			</if>

			<if test="deptNo != null and deptNo != 0">
				AND e.DEPT_NO = #{deptNo}
			</if>

			<if test="statusNo != null and statusNo != -1">
				AND e.STATUS_NO = #{statusNo}
			</if>

			<if test="gradeNo != null and gradeNo != -1">
				AND e.GRADE_NO = #{gradeNo}
			</if>
		</where>

		ORDER BY e.EMP_NO
	</select>

	<!-- ============================
	     3) ÏÇ¨Î≤àÏúºÎ°ú Îã®Í±¥ Ï°∞Ìöå (Í≥µÏö©)
	     ============================ -->
	<select id="getEmp" parameterType="string" resultMap="empMap">
		SELECT
			e.EMP_NO,
			e.STATUS_NO,
			e.DEPT_NO,
			e.GRADE_NO,
			e.EMP_PASS,
			e.KAKAO_ID,
			e.EMP_NAME,
			e.EMP_PHONE,
			e.EMP_ADDR,
			e.EMP_EMAIL,
			e.EMP_IMAGE,
			e.EMP_REG_NO,
			TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
			e.SAL_BASE,
			d.DEPT_NAME,

			CASE e.STATUS_NO
				WHEN 0 THEN 'Ìá¥ÏßÅ'
				WHEN 1 THEN 'Ïû¨ÏßÅ'
				WHEN 2 THEN 'Ìú¥ÏßÅ(ÏûêÎ∞úÏ†Å)'
				WHEN 3 THEN 'Ìú¥ÏßÅ(Î≥ëÍ∞Ä Îì± Î≥µÏßÄ)'
				WHEN 4 THEN 'ÎåÄÍ∏∞'
				WHEN 5 THEN 'ÏßïÍ≥Ñ'
				WHEN 6 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
				WHEN 7 THEN 'ÌååÍ≤¨'
			END AS STATUS_NAME,

			CASE e.GRADE_NO
				WHEN 1 THEN 'ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê'
				WHEN 2 THEN 'Í¥ÄÎ¶¨Ïûê'
				WHEN 3 THEN 'ÏÇ¨Ïõê'
				WHEN 4 THEN 'Í≥ÑÏïΩÏÇ¨Ïõê'
				WHEN 5 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
				WHEN 6 THEN 'Í∏∞ÌÉÄ'
			END AS GRADE_NAME

		FROM EMP e
		LEFT JOIN DEPT d ON e.DEPT_NO = d.DEPT_NO
		WHERE e.EMP_NO = #{empNo}
	</select>

	<!-- ============================
	     4) ÏÇ¨Ïõê Îì±Î°ù - empNewForm Ï†ÑÏö©
	     ============================ -->
	<insert id="insertEmp" parameterType="com.example.domain.EmpVO">
		INSERT INTO EMP (
			EMP_NO,
			STATUS_NO,
			DEPT_NO,
			GRADE_NO,
			EMP_NAME,
			EMP_PHONE,
			EMP_ADDR,
			EMP_IMAGE,
			EMP_REG_NO,
			EMP_REGDATE,
			SAL_BASE
		)
		VALUES (
			#{empNo},
			#{statusNo},
			#{deptNo},
			#{gradeNo},
			#{empName},
			#{empPhone, jdbcType=VARCHAR},
			#{empAddr, jdbcType=VARCHAR},
			#{empImage, jdbcType=VARCHAR},
			#{empRegNo, jdbcType=VARCHAR},
			SYSDATE,
			#{salBase, jdbcType=INTEGER}
		)
	</insert>

	<!-- ============================
	     5) ÏÇ¨Ïõê Ï†ïÎ≥¥ ÏàòÏ†ï- empCard ÏàòÏ†ï Î™®Îìú
	     ============================ -->
	<update id="updateEmp" parameterType="com.example.domain.EmpVO">
		UPDATE EMP
		SET STATUS_NO = #{statusNo},
		    GRADE_NO  = #{gradeNo},
		    EMP_PHONE = #{empPhone},
		    EMP_ADDR  = #{empAddr},
		    EMP_EMAIL = #{empEmail},
		    EMP_IMAGE = #{empImage}
		WHERE EMP_NO = #{empNo}
	</update>

	<!-- ============================
	     6) ÏÇ¨Ïõê ÏÇ≠Ï†ú (Î¨ºÎ¶¨ ÏÇ≠Ï†ú)
	     ============================ -->
	<delete id="deleteEmp" parameterType="string">
		DELETE FROM EMP
		WHERE EMP_NO = #{empNo}
	</delete>

	<!-- ============================
	     7) ÏÇ¨Î≤à Ï§ëÎ≥µ Ï≤¥ÌÅ¨  - Ìá¥ÏßÅÏûê Ìè¨Ìï® Ï†ÑÏ≤¥ Í∏∞Ï§Ä
	     ============================ -->
	<select id="isEmpNoDuplicate" resultType="int">
		SELECT COUNT(*)
		FROM EMP
		WHERE EMP_NO = #{empNo}
	</select>

	<!-- ============================
	     8) Î∂ÄÏÑúÏû•/ÏßÅÏ±Ö ÏÑ§Ï†ï
	     ============================ -->
	<update id="setEmpJobTitle" parameterType="map">
		UPDATE EMP
		SET JOB_TITLE = #{jobTitle},
		    GRADE_NO = #{targetGradeNo, jdbcType=NUMERIC}
		WHERE EMP_NO = #{empNo}
	</update>
	
	<select id="selectEmpNoListByDept" parameterType="String" resultType="string">
	    SELECT 
	        EMP_NO
	    FROM EMP
	    WHERE DEPT_NO = #{deptNo}
	      AND STATUS_NO != 0
	</select>
	
	<select id="selectAllEmpNoList" resultType="string">
	    SELECT 
	        EMP_NO
	    FROM EMP
	    WHERE STATUS_NO != 0
	</select>

</mapper>
