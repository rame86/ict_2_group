<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.repository.EmpMapper">

	<!-- ============================ κ³µν†µ ResultMap ============================ -->
	<resultMap id="empMap" type="com.example.domain.EmpVO">

		<id column="EMP_NO" property="empNo" />

		<result column="STATUS_NO" property="statusNo" />
		<result column="DEPT_NO" property="deptNo" />
		<result column="GRADE_NO" property="gradeNo" />

		<result column="EMP_PASS" property="empPass" />
		<result column="KAKAO_ID" property="kakaoId" />

		<result column="EMP_NAME" property="empName" />
		<result column="EMP_PHONE" property="empPhone" />
		<result column="EMP_ADDR" property="empAddr" />
		<result column="EMP_EMAIL" property="empEmail" />
		<result column="EMP_IMAGE" property="empImage" />
		<result column="EMP_REG_NO" property="empRegNo" />

		<!-- DATE β†’ String μΌλ΅ λ°›κΈ° μ„ν•΄ TO_CHAR ν• λ³„μΉ­ -->
		<result column="EMP_REGDATE" property="empRegdate" />

		<result column="SAL_BASE" property="salBase" />

		<!-- μ΅°μΈλ ν™”λ©΄μ© ν•„λ“ -->
		<result column="DEPT_NAME" property="deptName" />
		<result column="STATUS_NAME" property="statusName" />
		<result column="GRADE_NAME" property="gradeName" />
	</resultMap>

	<!-- ============================ 1) μ „μ²΄ μ‚¬μ› λ©λ΅ (κ²€μƒ‰ μ—†μ) ============================ -->
	<select id="selectEmpList" resultMap="empMap">
		SELECT
		e.EMP_NO,
		e.STATUS_NO,
		e.DEPT_NO,
		e.GRADE_NO,
		e.EMP_PASS,
		e.KAKAO_ID,
		e.EMP_NAME,
		e.EMP_PHONE,
		e.EMP_ADDR,
		e.EMP_EMAIL,
		e.EMP_IMAGE,
		e.EMP_REG_NO,
		TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
		e.SAL_BASE,
		d.DEPT_NAME,
		CASE e.STATUS_NO
		WHEN 0 THEN 'ν‡΄μ§'
		WHEN 1 THEN 'μ¬μ§'
		WHEN 2
		THEN 'ν΄μ§(μλ°μ )'
		WHEN 3 THEN 'ν΄μ§(λ³‘κ°€ λ“± λ³µμ§€)'
		WHEN 4 THEN 'λ€κΈ°'
		WHEN 5 THEN
		'μ§•κ³„'
		WHEN 6 THEN 'μΈν„΄/μμµ'
		WHEN 7 THEN 'νκ²¬'
		END AS STATUS_NAME,
		CASE e.GRADE_NO
		    WHEN 1 THEN 'μµκ³ κ΄€λ¦¬μ'
		    WHEN 2 THEN 'κ΄€λ¦¬μ'
		    WHEN 3 THEN 'μ‚¬μ›'
		    WHEN 4 THEN 'κ³„μ•½μ‚¬μ›'
		    WHEN 5 THEN 'μΈν„΄/μμµ'
		    WHEN 6 THEN 'κΈ°νƒ€'
		END AS GRADE_NAME
		FROM EMP e
		LEFT JOIN DEPT
		d ON e.DEPT_NO = d.DEPT_NO
		ORDER BY e.EMP_NO
	</select>


	<!-- ============================ 2) κ²€μƒ‰ ν¬ν•¨ μ‚¬μ› λ©λ΅ (EmpSearchVO μ‚¬μ©) ============================ -->
	<select id="getEmpList"
        parameterType="com.example.domain.EmpSearchVO"
        resultMap="empMap">

    SELECT
        e.EMP_NO,
        e.STATUS_NO,
        e.DEPT_NO,
        e.GRADE_NO,
        e.EMP_PASS,
        e.KAKAO_ID,
        e.EMP_NAME,
        e.EMP_PHONE,
        e.EMP_ADDR,
        e.EMP_EMAIL,
        e.EMP_IMAGE,
        e.EMP_REG_NO,
        TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
        e.SAL_BASE,
        d.DEPT_NAME,

        -- μ¬μ§ μƒνƒ ν•κΈ€ μ΄λ¦„
        CASE e.STATUS_NO
            WHEN 0 THEN 'ν‡΄μ§'
            WHEN 1 THEN 'μ¬μ§'
            WHEN 2 THEN 'ν΄μ§(μλ°μ )'
            WHEN 3 THEN 'ν΄μ§(λ³‘κ°€ λ“± λ³µμ§€)'
            WHEN 4 THEN 'λ€κΈ°'
            WHEN 5 THEN 'μ§•κ³„'
            WHEN 6 THEN 'μΈν„΄/μμµ'
            WHEN 7 THEN 'νκ²¬'
        END AS STATUS_NAME,

        -- κ¶ν•/μ§κΈ‰ ν•κΈ€ μ΄λ¦„
        CASE e.GRADE_NO
            WHEN 1 THEN 'μµκ³ κ΄€λ¦¬μ'
            WHEN 2 THEN 'κ΄€λ¦¬μ'
            WHEN 3 THEN 'μ‚¬μ›'
            WHEN 4 THEN 'κ³„μ•½μ‚¬μ›'
            WHEN 5 THEN 'μΈν„΄/μμµ'
            WHEN 6 THEN 'κΈ°νƒ€'
        END AS GRADE_NAME

    FROM EMP e
    LEFT JOIN DEPT d ON e.DEPT_NO = d.DEPT_NO

    <where>
        <!-- keyword: μ΄λ¦„/μ „ν™”/μ΄λ©”μΌ ν†µν•© κ²€μƒ‰ -->
        <if test="keyword != null and keyword != ''">
            AND (
                    e.EMP_NAME  LIKE '%' || #{keyword} || '%'
                OR  e.EMP_PHONE LIKE '%' || #{keyword} || '%'
                OR  e.EMP_EMAIL LIKE '%' || #{keyword} || '%'
            )
        </if>

        <!-- λ¶€μ„ν•„ν„° -->
        <if test="deptNo != null and deptNo != 0">
            AND e.DEPT_NO = #{deptNo}
        </if>

        <!-- μ¬μ§μƒνƒ ν•„ν„° -->
        <if test="statusNo != null and statusNo != -1">
            AND e.STATUS_NO = #{statusNo}
        </if>

        <!-- κ¶ν• λ“±κΈ‰ ν•„ν„° -->
        <if test="gradeNo != null and gradeNo != -1">
            AND e.GRADE_NO = #{gradeNo}
        </if>
    </where>

    ORDER BY e.EMP_NO
</select>


	<!-- ============================ 3) μ‚¬λ²μΌλ΅ λ‹¨κ±΄ μ΅°ν ============================ -->
	<select id="getEmp" parameterType="string" resultMap="empMap">
    SELECT
        e.EMP_NO,
        e.STATUS_NO,
        e.DEPT_NO,
        e.GRADE_NO,
        e.EMP_PASS,
        e.KAKAO_ID,
        e.EMP_NAME,
        e.EMP_PHONE,
        e.EMP_ADDR,
        e.EMP_EMAIL,
        e.EMP_IMAGE,
        e.EMP_REG_NO,
        TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
        e.SAL_BASE,
        d.DEPT_NAME,

        -- μ¬μ§ μƒνƒ ν•κΈ€ μ΄λ¦„
        CASE e.STATUS_NO
            WHEN 0 THEN 'ν‡΄μ§'
            WHEN 1 THEN 'μ¬μ§'
            WHEN 2 THEN 'ν΄μ§(μλ°μ )'
            WHEN 3 THEN 'ν΄μ§(λ³‘κ°€ λ“± λ³µμ§€)'
            WHEN 4 THEN 'λ€κΈ°'
            WHEN 5 THEN 'μ§•κ³„'
            WHEN 6 THEN 'μΈν„΄/μμµ'
            WHEN 7 THEN 'νκ²¬'
        END AS STATUS_NAME,

        -- κ¶ν•/μ§κΈ‰ ν•κΈ€ μ΄λ¦„
        CASE e.GRADE_NO
            WHEN 1 THEN 'μµκ³ κ΄€λ¦¬μ'
            WHEN 2 THEN 'κ΄€λ¦¬μ'
            WHEN 3 THEN 'μ‚¬μ›'
            WHEN 4 THEN 'κ³„μ•½μ‚¬μ›'
            WHEN 5 THEN 'μΈν„΄/μμµ'
            WHEN 6 THEN 'κΈ°νƒ€'
        END AS GRADE_NAME

    FROM EMP e
    LEFT JOIN DEPT d ON e.DEPT_NO = d.DEPT_NO
    WHERE e.EMP_NO = #{empNo}
</select>

    <!-- ============================ 3-1) μ‚¬λ²μΌλ΅ λ‹¨κ±΄ μ΅°ν (μΈμ‚¬μΉ΄λ“μ©) ============================ -->
    <select id="selectEmpByEmpNo" parameterType="string" resultMap="empMap">
        SELECT
            e.EMP_NO,
            e.STATUS_NO,
            e.DEPT_NO,
            e.GRADE_NO,
            e.EMP_PASS,
            e.KAKAO_ID,
            e.EMP_NAME,
            e.EMP_PHONE,
            e.EMP_ADDR,
            e.EMP_EMAIL,
            e.EMP_IMAGE,
            e.EMP_REG_NO,
            TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
            e.SAL_BASE,
            d.DEPT_NAME,

            -- μ¬μ§ μƒνƒ ν•κΈ€ μ΄λ¦„
            CASE e.STATUS_NO
                WHEN 0 THEN 'ν‡΄μ§'
                WHEN 1 THEN 'μ¬μ§'
                WHEN 2 THEN 'ν΄μ§(μλ°μ )'
                WHEN 3 THEN 'ν΄μ§(λ³‘κ°€ λ“± λ³µμ§€)'
                WHEN 4 THEN 'λ€κΈ°'
                WHEN 5 THEN 'μ§•κ³„'
                WHEN 6 THEN 'μΈν„΄/μμµ'
                WHEN 7 THEN 'νκ²¬'
            END AS STATUS_NAME,

            -- κ¶ν•/μ§κΈ‰ ν•κΈ€ μ΄λ¦„
            CASE e.GRADE_NO
                WHEN 1 THEN 'μµκ³ κ΄€λ¦¬μ'
                WHEN 2 THEN 'κ΄€λ¦¬μ'
                WHEN 3 THEN 'μ‚¬μ›'
                WHEN 4 THEN 'κ³„μ•½μ‚¬μ›'
                WHEN 5 THEN 'μΈν„΄/μμµ'
                WHEN 6 THEN 'κΈ°νƒ€'
            END AS GRADE_NAME

        FROM EMP e
        LEFT JOIN DEPT d ON e.DEPT_NO = d.DEPT_NO
        WHERE e.EMP_NO = #{empNo}
    </select>



	<!-- ============================ 4) μ‚¬μ› λ“±λ΅ (INSERT) ============================ -->
	<insert id="insertEmp" parameterType="com.example.domain.EmpVO">
		INSERT INTO EMP (
		EMP_NO,
		STATUS_NO,
		DEPT_NO,
		GRADE_NO,
		EMP_PASS,
		KAKAO_ID,
		EMP_NAME,
		EMP_PHONE,
		EMP_ADDR,
		EMP_EMAIL,
		EMP_IMAGE,
		EMP_REG_NO,
		EMP_REGDATE,
		SAL_BASE
		) VALUES (
		#{empNo},
		#{statusNo},
		#{deptNo},
		#{gradeNo},
		#{empPass, jdbcType=VARCHAR},   <!-- π”Ή μ—¬κΈ°μ— νƒ€μ… μ§€μ • -->
		#{kakaoId, jdbcType=VARCHAR},
		#{empName},
		#{empPhone},
		#{empAddr},
		#{empEmail},
		 #{empImage, jdbcType=VARCHAR},
		#{empRegNo, jdbcType=VARCHAR},
		SYSDATE,
		#{salBase, jdbcType=NUMERIC}
		)
	</insert>


	<!-- ============================ 5) μ‚¬μ› μ •λ³΄ μμ • (UPDATE) ============================ -->
	<update id="updateEmp" parameterType="com.example.domain.EmpVO">
    UPDATE EMP
       SET STATUS_NO = #{statusNo}
         , GRADE_NO  = #{gradeNo}
         , EMP_PHONE = #{empPhone}
         , EMP_ADDR  = #{empAddr}
         , EMP_EMAIL = #{empEmail}
         , EMP_IMAGE = #{empImage}   <!-- π”Ή μ¶”κ°€ -->
     WHERE EMP_NO   = #{empNo}
</update>

	<!-- ============================ 6) μ‚¬μ› μ‚­μ  ============================ -->
	<delete id="deleteEmp" parameterType="string">
		DELETE FROM EMP
		WHERE EMP_NO
		= #{empNo}
	</delete>
	
	<!-- μ‚¬λ² μ¤‘λ³µ μ²΄ν¬ -->
	<select id="isEmpNoDuplicate" resultType="int">
    SELECT COUNT(*)
    FROM EMP
    WHERE EMP_NO = #{empNo}
</select>

</mapper>
