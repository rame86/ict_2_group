<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.repository.EmpMapper">

	<!-- ============================ Í≥µÌÜµ ResultMap ============================ -->
	<resultMap id="empMap" type="com.example.domain.EmpVO">

		<id column="EMP_NO" property="empNo" />

		<result column="STATUS_NO" property="statusNo" />
		<result column="DEPT_NO" property="deptNo" />
		<result column="GRADE_NO" property="gradeNo" />

		<result column="EMP_PASS" property="empPass" />
		<result column="KAKAO_ID" property="kakaoId" />

		<result column="EMP_NAME" property="empName" />
		<result column="EMP_PHONE" property="empPhone" />
		<result column="EMP_ADDR" property="empAddr" />
		<result column="EMP_EMAIL" property="empEmail" />
		<result column="EMP_IMAGE" property="empImage" />
		<result column="EMP_REG_NO" property="empRegNo" />

		<!-- DATE ‚Üí String ÏúºÎ°ú Î∞õÍ∏∞ ÏúÑÌï¥ TO_CHAR Ìïú Î≥ÑÏπ≠ -->
		<result column="EMP_REGDATE" property="empRegdate" />

		<result column="SAL_BASE" property="salBase" />

		<!-- Ï°∞Ïù∏Îêú ÌôîÎ©¥Ïö© ÌïÑÎìú -->
		<result column="DEPT_NAME" property="deptName" />
		<result column="STATUS_NAME" property="statusName" />
		<result column="GRADE_NAME" property="gradeName" />
	</resultMap>

	<!-- ============================ 1) Ï†ÑÏ≤¥ ÏÇ¨Ïõê Î™©Î°ù (Í≤ÄÏÉâ ÏóÜÏùå) ============================ -->
	<select id="selectEmpList" resultMap="empMap">
		SELECT
		e.EMP_NO,
		e.STATUS_NO,
		e.DEPT_NO,
		e.GRADE_NO,
		e.EMP_PASS,
		e.KAKAO_ID,
		e.EMP_NAME,
		e.EMP_PHONE,
		e.EMP_ADDR,
		e.EMP_EMAIL,
		e.EMP_IMAGE,
		e.EMP_REG_NO,
		TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
		e.SAL_BASE,
		d.DEPT_NAME,
		CASE e.STATUS_NO
		WHEN 0 THEN 'Ìá¥ÏßÅ'
		WHEN 1 THEN 'Ïû¨ÏßÅ'
		WHEN 2
		THEN 'Ìú¥ÏßÅ(ÏûêÎ∞úÏ†Å)'
		WHEN 3 THEN 'Ìú¥ÏßÅ(Î≥ëÍ∞Ä Îì± Î≥µÏßÄ)'
		WHEN 4 THEN 'ÎåÄÍ∏∞'
		WHEN 5 THEN
		'ÏßïÍ≥Ñ'
		WHEN 6 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
		WHEN 7 THEN 'ÌååÍ≤¨'
		END AS STATUS_NAME,
		CASE e.GRADE_NO
		    WHEN 1 THEN 'ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê'
		    WHEN 2 THEN 'Í¥ÄÎ¶¨Ïûê'
		    WHEN 3 THEN 'ÏÇ¨Ïõê'
		    WHEN 4 THEN 'Í≥ÑÏïΩÏÇ¨Ïõê'
		    WHEN 5 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
		    WHEN 6 THEN 'Í∏∞ÌÉÄ'
		END AS GRADE_NAME
		FROM EMP e
		LEFT JOIN DEPT
		d ON e.DEPT_NO = d.DEPT_NO
		ORDER BY e.EMP_NO
	</select>


	<!-- ============================ 2) Í≤ÄÏÉâ Ìè¨Ìï® ÏÇ¨Ïõê Î™©Î°ù (EmpSearchVO ÏÇ¨Ïö©) ============================ -->
	<select id="getEmpList"
		parameterType="com.example.domain.EmpSearchVO" resultMap="empMap">

		SELECT
		e.EMP_NO,
		e.STATUS_NO,
		e.DEPT_NO,
		e.GRADE_NO,
		e.EMP_PASS,
		e.KAKAO_ID,
		e.EMP_NAME,
		e.EMP_PHONE,
		e.EMP_ADDR,
		e.EMP_EMAIL,
		e.EMP_IMAGE,
		e.EMP_REG_NO,
		TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
		e.BASE_SAL,
		d.DEPT_NAME,
		s.STATUS_NAME,
		g.GRADE_NAME
		FROM EMP e
		LEFT JOIN
		DEPT d ON e.DEPT_NO = d.DEPT_NO
		LEFT JOIN EMP_STATUS s ON e.STATUS_NO =
		s.STATUS_NO
		LEFT JOIN EMP_GRADE g ON e.GRADE_NO = g.GRADE_NO

		<where>
			<!-- ÏòàÏãú: EmpSearchVOÏóê Ïù¥Îü∞ ÌïÑÎìúÍ∞Ä ÏûàÎã§Í≥† Í∞ÄÏ†ï -->
			<!-- keyword: Ïù¥Î¶Ñ/Ï†ÑÌôî/Ïù¥Î©îÏùº ÌÜµÌï© Í≤ÄÏÉâ -->
			<if test="keyword != null and keyword != ''">
				AND ( e.EMP_NAME LIKE '%' || #{keyword} || '%'
				OR
				e.EMP_PHONE LIKE '%' || #{keyword} || '%'
				OR e.EMP_EMAIL LIKE '%' ||
				#{keyword} || '%'
				)
			</if>

			<!-- Î∂ÄÏÑúÌïÑÌÑ∞ -->
			<if test="deptNo != null and deptNo != 0">
				AND e.DEPT_NO = #{deptNo}
			</if>

			<!-- Ïû¨ÏßÅÏÉÅÌÉú ÌïÑÌÑ∞ -->
			<if test="statusNo != null and statusNo != -1">
				AND e.STATUS_NO = #{statusNo}
			</if>

			<!-- Í∂åÌïú Îì±Í∏â ÌïÑÌÑ∞ -->
			<if test="gradeNo != null and gradeNo != -1">
				AND e.GRADE_NO = #{gradeNo}
			</if>
		</where>

		ORDER BY e.EMP_NO
	</select>

	<!-- ============================ 3) ÏÇ¨Î≤àÏúºÎ°ú Îã®Í±¥ Ï°∞Ìöå ============================ -->
	<select id="getEmp" parameterType="string" resultMap="empMap">
		SELECT
		e.EMP_NO,
		e.STATUS_NO,
		e.DEPT_NO,
		e.GRADE_NO,
		e.EMP_PASS,
		e.KAKAO_ID,
		e.EMP_NAME,
		e.EMP_PHONE,
		e.EMP_ADDR,
		e.EMP_EMAIL,
		e.EMP_IMAGE,
		e.EMP_REG_NO,
		TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
		e.BASE_SAL,
		d.DEPT_NAME,
		s.STATUS_NAME,
		g.GRADE_NAME
		FROM EMP e
		LEFT JOIN
		DEPT d ON e.DEPT_NO = d.DEPT_NO
		LEFT JOIN EMP_STATUS s ON e.STATUS_NO =
		s.STATUS_NO
		LEFT JOIN EMP_GRADE g ON e.GRADE_NO = g.GRADE_NO
		WHERE
		e.EMP_NO = #{empNo}
	</select>

	<!-- ÌïÑÏöîÌïòÎã§Î©¥ selectEmpByEmpNoÎèÑ getEmpÏôÄ ÎèôÏùºÌïòÍ≤å ÏÇ¨Ïö© Í∞ÄÎä• -->
	<select id="selectEmpByEmpNo" parameterType="string"
		resultMap="empMap">

		SELECT
		e.EMP_NO,
		e.STATUS_NO,
		e.DEPT_NO,
		e.GRADE_NO,
		e.EMP_PASS,
		e.KAKAO_ID,
		e.EMP_NAME,
		e.EMP_PHONE,
		e.EMP_ADDR,
		e.EMP_EMAIL,
		e.EMP_IMAGE,
		e.EMP_REG_NO,
		TO_CHAR(e.EMP_REGDATE, 'YYYY-MM-DD') AS EMP_REGDATE,
		e.SAL_BASE, -- ‚úÖ Ïª¨ÎüºÎ™Ö SAL_BASEÎ°ú ÎßûÏ∂îÍ∏∞
		d.DEPT_NAME,

		-- Ïû¨ÏßÅ ÏÉÅÌÉú ÌïúÍ∏Ä Ïù¥Î¶Ñ
		CASE e.STATUS_NO
		WHEN 0 THEN 'Ìá¥ÏßÅ'
		WHEN 1 THEN 'Ïû¨ÏßÅ'
		WHEN 2 THEN 'Ìú¥ÏßÅ(ÏûêÎ∞úÏ†Å)'
		WHEN 3 THEN 'Ìú¥ÏßÅ(Î≥ëÍ∞Ä Îì± Î≥µÏßÄ)'
		WHEN 4 THEN 'ÎåÄÍ∏∞'
		WHEN 5 THEN 'ÏßïÍ≥Ñ'
		WHEN 6 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
		WHEN 7 THEN 'ÌååÍ≤¨'
		END AS STATUS_NAME,

		-- Í∂åÌïú/ÏßÅÍ∏â ÌïúÍ∏Ä Ïù¥Î¶Ñ
		CASE e.GRADE_NO
		WHEN 1 THEN 'ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê'
		WHEN 2 THEN 'Í¥ÄÎ¶¨Ïûê'
		WHEN 3 THEN 'ÏÇ¨Ïõê'
		WHEN 4 THEN 'Í≥ÑÏïΩÏÇ¨Ïõê'
		WHEN 5 THEN 'Ïù∏ÌÑ¥/ÏàòÏäµ'
		WHEN 6 THEN 'Í∏∞ÌÉÄ'
		END AS GRADE_NAME

		FROM EMP e
		LEFT JOIN DEPT d ON e.DEPT_NO = d.DEPT_NO
		WHERE e.EMP_NO = #{empNo}

	</select>


	<!-- ============================ 4) ÏÇ¨Ïõê Îì±Î°ù (INSERT) ============================ -->
	<insert id="insertEmp" parameterType="com.example.domain.EmpVO">
		INSERT INTO EMP (
		EMP_NO,
		STATUS_NO,
		DEPT_NO,
		GRADE_NO,
		EMP_PASS,
		KAKAO_ID,
		EMP_NAME,
		EMP_PHONE,
		EMP_ADDR,
		EMP_EMAIL,
		EMP_IMAGE,
		EMP_REG_NO,
		EMP_REGDATE,
		SAL_BASE
		) VALUES (
		#{empNo},
		#{statusNo},
		#{deptNo},
		#{gradeNo},
		#{empPass, jdbcType=VARCHAR},   <!-- üîπ Ïó¨Í∏∞Ïóê ÌÉÄÏûÖ ÏßÄÏ†ï -->
		#{kakaoId, jdbcType=VARCHAR},
		#{empName},
		#{empPhone},
		#{empAddr},
		#{empEmail},
		#{empImage, jdbcType=VARCHAR},
		#{empRegNo, jdbcType=VARCHAR},
		TO_DATE(#{empRegdate, jdbcType=VARCHAR}, 'YYYY-MM-DD'),
		#{salBase, jdbcType=NUMERIC}
		)
	</insert>


	<!-- ============================ 5) ÏÇ¨Ïõê Ï†ïÎ≥¥ ÏàòÏ†ï (UPDATE) ============================ -->
	<update id="updateEmp" parameterType="com.example.domain.EmpVO">
		UPDATE EMP
		SET
		STATUS_NO = #{statusNo},
		GRADE_NO = #{gradeNo},
		EMP_PHONE = #{empPhone},
		EMP_EMAIL = #{empEmail},
		EMP_ADDR = #{empAddr}
		WHERE
		EMP_NO = #{empNo}
	</update>

	<!-- ============================ 6) ÏÇ¨Ïõê ÏÇ≠Ï†ú ============================ -->
	<delete id="deleteEmp" parameterType="string">
		DELETE FROM EMP
		WHERE EMP_NO
		= #{empNo}
	</delete>

</mapper>
